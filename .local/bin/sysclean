#!/bin/bash

# ================================================
# ARCH-MECHANIC CLEANUP SCRIPT 完
# "Sistemi ilk g羹nk羹 safl覺覺na d繹nd羹r羹r"
# ================================================

GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}>>> Temizlik operasyonu bal覺yor...${NC}"

# 1. Paket nbellei Temizlii (pacman & yay)
echo -e "${YELLOW}[1/6] Paket 繹nbellei temizleniyor...${NC}"
# Yar覺m kalm覺 indirmeleri (download-*) temizleyerek o fd 7 hatas覺n覺 engelle
sudo rm -f /var/cache/pacman/pkg/download-* 2>/dev/null
sudo pacman -Sc --noconfirm
if command -v yay &> /dev/null; then
    yay -Sc --noconfirm
fi

# 2. Yetim Paketlerin (Orphans) Kald覺r覺lmas覺
echo -e "${YELLOW}[2/6] Yetim paketler kontrol ediliyor...${NC}"
ORPHANS=$(pacman -Qtdq)
if [ -n "$ORPHANS" ]; then
    sudo pacman -Rns $ORPHANS --noconfirm
else
    echo -e "${GREEN}>>> Yetim paket bulunamad覺.${NC}"
fi

# 3. Sistem Loglar覺 ve Journal Temizlii
echo -e "${YELLOW}[3/6] Sistem loglar覺 ve Journal temizleniyor...${NC}"
sudo journalctl --vacuum-time=3d
sudo journalctl --vacuum-size=50M

# 4. Ge癟ici Dosyalar ve Junk Temizlii
echo -e "${YELLOW}[4/6] Ge癟ici dosyalar ve 癟繹p kutusu boalt覺l覺yor...${NC}"
# Trash (繹p Kutusu)
rm -rf ~/.local/share/Trash/*
# .bak , .tmp ve eski log dosyalar覺
find ~/.config -name "*.bak" -type f -delete
find ~/.config -name "*.tmp" -type f -delete
find ~/.local/state -name "*.log" -type f -mtime +7 -delete
# K覺r覺k sembolik linkler
find ~ -xtype l -path '*/.*' -prune -o -type l -delete 2>/dev/null

# 5. Thumbnail ve Genel Cache Temizlii
echo -e "${YELLOW}[5/6] Thumbnail ve genel cache temizleniyor...${NC}"
rm -rf ~/.cache/thumbnails/*
# 15 g羹nden eski cache dosyalar覺n覺 sil (daha agresif)
find ~/.cache -type f -atime +15 -delete

# 6. Gelitirici nbellekleri (Eer varsa)
echo -e "${YELLOW}[6/6] Gelitirici ara癟lar覺 繹nbellekleri kontrol ediliyor...${NC}"
[ -d ~/.npm/_cacache ] && rm -rf ~/.npm/_cacache && echo -e "${GREEN}>>> NPM cache temizlendi.${NC}"
[ -d ~/.cache/pip ] && rm -rf ~/.cache/pip && echo -e "${GREEN}>>> Pip cache temizlendi.${NC}"
[ -d ~/.cache/go-build ] && rm -rf ~/.cache/go-build && echo -e "${GREEN}>>> Go build cache temizlendi.${NC}"

echo -e "${BLUE}==================================================${NC}"
echo -e "${GREEN}   TEM襤ZL襤K TAMAMLANDI! Sistemin mermi gibi.   ${NC}"
echo -e "${BLUE}==================================================${NC}"

